<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Estudante - Transporte Universitário</title>
  <link rel="stylesheet" href="style/aluno.css" />

  <!-- QRCode via CDN -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCVs1jcbA9qlS17Rb8HJy-oPgxmyHn_o48",
      authDomain: "universitario-693d0.firebaseapp.com",
      projectId: "universitario-693d0",
      storageBucket: "universitario-693d0.appspot.com",
      messagingSenderId: "660423807577",
      appId: "1:660423807577:web:834e3b3c039468fbe7d748",
      measurementId: "G-LTGM5K16YH"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");

    async function carregarLanding() {
      if (!id) {
        document.body.innerHTML = "<p>ID do estudante não informado.</p>";
        return;
      }

      const UID = "wPHOxRUJKdPWcW6LXK1DHvdOKsj1";
      const docRef = doc(db, "usuarios", UID, "estudantes", id);
      console.log(docRef)
      // const docRef = doc(db, "estudantes", id);
      const docSnap = await getDoc(docRef);

      if (docSnap.exists()) {
        const est = docSnap.data();

        const container = document.createElement("div");
        container.className = "landing";

        const statusClass = est.status === "Ativo" ? "ativo-box" : "inativo-box";

        container.innerHTML = `
          <div class="status-box ${statusClass}">${est.status}</div>
          <canvas id="qrcode" class="qrcode"></canvas>
          <div class="info"><strong>Nome:</strong> ${est.nome}</div>
          <div class="info"><strong>Faculdade:</strong> ${est.faculdade}</div>
          <div class="info"><strong>Curso:</strong> ${est.curso}</div>
          <div class="info"><strong>Turno:</strong> ${est.turno}</div>
        `;

        document.body.innerHTML = '';
        document.body.appendChild(container);

        const url = window.location.href;
        QRCode.toCanvas(document.getElementById("qrcode"), url, { width: 225 });
      } else {
        document.body.innerHTML = "<p>Estudante não encontrado.</p>";
      }
    }

    carregarLanding();
  </script>
</head>
<body>
  <p>Carregando...</p>
</body>
</html>